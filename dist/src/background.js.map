{"version":3,"file":"background.js","sources":["../../src/background.ts"],"sourcesContent":["// Background script for DOMinator extension\n\n// Track which tabs have the content script loaded\nconst contentScriptTabs = new Set<number>();\n\n// Listen for installation\nchrome.runtime.onInstalled.addListener(() => {\n  // Extension installed\n});\n\n// Listen for tab updates\nchrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\n  // If the tab is fully loaded and has a supported URL, inject the content script\n  if (\n    changeInfo.status === \"complete\" &&\n    tab.url &&\n    tab.url.startsWith(\"http\")\n  ) {\n    // Try to inject the content script\n    chrome.scripting\n      .executeScript({\n        target: { tabId },\n        files: [\"src/content.js\"],\n      })\n      .then(() => {\n        contentScriptTabs.add(tabId);\n      })\n      .catch(() => {\n        // Ignore errors - some pages don't allow content scripts\n      });\n  }\n});\n\n// Listen for messages from content script or popup\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message.action === \"contentScriptReady\" && sender.tab?.id) {\n    // Content script has loaded in a tab\n    contentScriptTabs.add(sender.tab.id);\n    sendResponse({ success: true });\n    return true;\n  }\n\n  if (message.action === \"checkContentScript\" && message.tabId) {\n    // Check if content script is loaded in the specified tab\n    const isLoaded = contentScriptTabs.has(message.tabId);\n\n    if (isLoaded) {\n      sendResponse({ isLoaded });\n    } else {\n      // Try to inject the content script if not loaded\n      try {\n        chrome.scripting\n          .executeScript({\n            target: { tabId: message.tabId },\n            files: [\"src/content.js\"],\n          })\n          .then(() => {\n            contentScriptTabs.add(message.tabId);\n            sendResponse({ isLoaded: true, injected: true });\n          })\n          .catch((error) => {\n            sendResponse({ isLoaded: false, error: error.message });\n          });\n      } catch (error) {\n        sendResponse({ isLoaded: false, error: String(error) });\n      }\n      return true;\n    }\n  }\n\n  if (message.action === \"getAIExplanation\") {\n    // This is where you would make an API call to OpenAI or similar\n    // For now, we'll just simulate a response\n    setTimeout(() => {\n      sendResponse({\n        explanation: `This appears to be a ${\n          message.tagName\n        } element used for ${\n          message.tagName === \"DIV\"\n            ? \"grouping content\"\n            : message.tagName === \"BUTTON\"\n            ? \"user interaction\"\n            : message.tagName === \"NAV\"\n            ? \"navigation\"\n            : \"containing content\"\n        }. ${\n          message.tagName === \"DIV\" && !message.attributes.role\n            ? \"Consider using a more semantic element or adding a role attribute for better accessibility.\"\n            : \"\"\n        }`,\n      });\n    }, 500);\n\n    // Return true to indicate we'll respond asynchronously\n    return true;\n  }\n\n  return false;\n});\n\n// Clean up when tabs are closed\nchrome.tabs.onRemoved.addListener((tabId) => {\n  contentScriptTabs.delete(tabId);\n});\n"],"names":["contentScriptTabs","tabId","changeInfo","tab","message","sender","sendResponse","_a","isLoaded","error"],"mappings":"AAGA,MAAMA,MAAwB,IAG9B,OAAO,QAAQ,YAAY,YAAY,IAAM,CAE7C,CAAC,EAGD,OAAO,KAAK,UAAU,YAAY,CAACC,EAAOC,EAAYC,IAAQ,CAG1DD,EAAW,SAAW,YACtBC,EAAI,KACJA,EAAI,IAAI,WAAW,MAAM,GAGzB,OAAO,UACJ,cAAc,CACb,OAAQ,CAAE,MAAAF,CAAM,EAChB,MAAO,CAAC,gBAAgB,CAAA,CACzB,EACA,KAAK,IAAM,CACVD,EAAkB,IAAIC,CAAK,CAAA,CAC5B,EACA,MAAM,IAAM,CAAA,CAEZ,CAEP,CAAC,EAGD,OAAO,QAAQ,UAAU,YAAY,CAACG,EAASC,EAAQC,IAAiB,CA/BxE,IAAAC,EAgCE,GAAIH,EAAQ,SAAW,wBAAwBG,EAAAF,EAAO,MAAP,MAAAE,EAAY,IAEvC,OAAAP,EAAA,IAAIK,EAAO,IAAI,EAAE,EACtBC,EAAA,CAAE,QAAS,EAAA,CAAM,EACvB,GAGT,GAAIF,EAAQ,SAAW,sBAAwBA,EAAQ,MAAO,CAE5D,MAAMI,EAAWR,EAAkB,IAAII,EAAQ,KAAK,EAEpD,GAAII,EACWF,EAAA,CAAE,SAAAE,EAAU,MACpB,CAED,GAAA,CACF,OAAO,UACJ,cAAc,CACb,OAAQ,CAAE,MAAOJ,EAAQ,KAAM,EAC/B,MAAO,CAAC,gBAAgB,CAAA,CACzB,EACA,KAAK,IAAM,CACQJ,EAAA,IAAII,EAAQ,KAAK,EACnCE,EAAa,CAAE,SAAU,GAAM,SAAU,EAAM,CAAA,CAAA,CAChD,EACA,MAAOG,GAAU,CAChBH,EAAa,CAAE,SAAU,GAAO,MAAOG,EAAM,QAAS,CAAA,CACvD,QACIA,EAAO,CACdH,EAAa,CAAE,SAAU,GAAO,MAAO,OAAOG,CAAK,EAAG,CACxD,CACO,MAAA,EACT,CACF,CAEI,OAAAL,EAAQ,SAAW,oBAGrB,WAAW,IAAM,CACFE,EAAA,CACX,YAAa,wBACXF,EAAQ,OACV,qBACEA,EAAQ,UAAY,MAChB,mBACAA,EAAQ,UAAY,SACpB,mBACAA,EAAQ,UAAY,MACpB,aACA,oBACN,KACEA,EAAQ,UAAY,OAAS,CAACA,EAAQ,WAAW,KAC7C,8FACA,EACN,EAAA,CACD,GACA,GAAG,EAGC,IAGF,EACT,CAAC,EAGD,OAAO,KAAK,UAAU,YAAaH,GAAU,CAC3CD,EAAkB,OAAOC,CAAK,CAChC,CAAC"}